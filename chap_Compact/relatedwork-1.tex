\subsection{Other Related Works}
%¸÷¸ö·½ÏòÈ«¶¼¼ÓÈë£¬ÀýÈç°²È«·ÖÎö
\label{sec:related}
%Various SSO services have been designed, implemented and investigated for several years.

%Various SSO protocols have been proposed, such as OIDC, SAML, OAuth 2.0, Central Authentication Service \cite{aubry2004esup} and Kerberos \cite{Kerberos}.
%These protocols are widely adopted in Google, Facebook, Shibboleth project \cite{Shibboleth}, Java applications, etc.
%And, plenty of works have been conducted on privacy protection and security analysis for SSO systems.

%\subsection{Privacy protection for SSO systems.}

%\noindent\textbf{Privacy-preserving SSO systems.}
%%ÔÚÃèÊöPrivacy-preserving SSO systemsµÄÄÚÈÝÖÐ£¬ÊÇ·ñÐèÒªÔ­ÎÄÖÐµÄÒÔÏÂÄÚÈÝ£º
%%1.BrowserIDµÄ°²È«ÎÊÌâ 2.ÎÒÃÇ·½°¸µÄÓÅµã
%%Privacy problems in SSO have been widely recognized that, as suggested in NIST SP800-63C \cite{NIST2017draft}, SSO systems should prevent both RP-based identity linkage and IdP-based login tracing. However, only a few solutions were proposed to protect user privacy so far. The pairwise user identifier, a simple design of function $\mathcal{F}_{ID_{U} \mapsto PID_{U}}$, has been specified in widely adopted deployed SSO standards, such as SAML \cite{SAML} and OIDC \cite{OpenIDConnect}. However, pairwise user identifier cannot prevent the IdP-based login tracing attack, as it doesn't adopt the function $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$, therefore exposing $ID_{RP}$ to RP directly. To best of our knowledge, so far only SPRESSO \cite{SPRESSO} and BrowserID \cite{BrowserID} are proposed to prevent RP-based identity linkage by designing the individual function $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$. However, neither SPRESSO nor BrowserID have proposed the function $\mathcal{F}_{ID_{U} \mapsto PID_{U}}$, which makes they are vulnerable to IdP-based login tracing. Moreover, there is no simple way to combine the existing function $\mathcal{F}_{ID_{U} \mapsto PID_{U}}$ and $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$, as the dilemma is discussed in Section \ref{**} which breaks the \textbf{user identification} in SSO system.
%As suggested by NIST \cite{NIST2017draft}, SSO systems should prevent both  RP-based identity linkage and IdP-based login tracing.
%The pairwise user identifier is adopted in SAML \cite{SAMLIdentifier} and OIDC \cite{OpenIDConnect}, and only prevents RP--based identity linkage; while SPRESSO \cite{SPRESSO} and BrowserID \cite{BrowserID} only prevent  IdP-based login tracing.
%BrowserID is adopted in Persona \cite{persona} and Firefox Accounts \cite{FirefoxAccount}, however an analysis on Persona found IdP-based login tracing could still succeed \cite{FettKS14, BrowserID}.
%UPPRESSO prevents both the RP-based identity linkage and IdP-based login tracing and could be integrated into OIDC which has been formally analyzed \cite{FettKS17}.
%%Moreover, OAuth and OIDC allow users to determine the scope of attributes exposed to the RP.
%

%\vspace{1mm}
\noindent\textbf{Anonymous SSO.}
Anonymous SSO schemes allow authenticated users to access a service protected by the IdP,
    without revealing their identities.
Anonymous SSO was proposed for the global system for mobile (GSM) communications \cite{ElmuftiWRR08},
    and formalized \cite{WangWS13}.
Privacy-preserving primitives, such as group signature, zero-knowledge proof, Chebyshev Chaotic Maps and proxy re-verification,
     were adopted to design anonymous SSO \cite{WangWS13,HanCSTW18,Lee18,HanCSTWW20}.
Anonymous SSO schemes work for some applications,
    but are unapplicable to most systems that require user identification for customized services.

\vspace{1mm}
\noindent\textbf{Privacy-preserving tokens/credentials.}
In addition to login,
    tokens (or credentials) authorize a user to conduct operations
        in privacy-preserving ways.
ZKlaims \cite{zklaim} allow users to prove statements on the credentials issued by a trusted party
    using zero-knowledge proofs,
        but the credential contents are not revealed.
PrivacyPass \cite{privacypass} allows a user to receive a great amount of anonymous tokens.
 These tokens are used to access resources on content delivery networks,
    so  the user does not interact with challenges such as CAPTCHAs.
Crypto-Book \cite{crypto-book} coordinates key servers to generate a ring-signature private key,
 and a user picks up his private key through a list of Email addresses (i.e., an anonymity set).
 Then, the key pair works as an untraceable pseudonym to sign messages.
Two-party threshold-cryptography schemes are implemented with a central server,
    to improve the security of user private keys \cite{mRSA,ss-rsa}:
    to sign or decrypt a message, the user needs a token from the server.
    Tandem \cite{tandem} decouples the obtaining and using of such tokens,
to preserve the privacy of key usage.

\vspace{1mm}
\noindent\textbf{SSO protocol analysis.}
%The SSO standards (e.g., SAML, OAuth, and OIDC) have been formally analyzed.
Fett et al. \cite{FettKS16, FettKS17} formally analyzed OAuth 2.0 and OIDC using an expressive Dolev-Yao style model \cite{FettKS14},
    and presented the attacks of 307 redirection and IdP mix-up.
        %When the IdP misuses an HTTP 307 status code for redirection, the sensitive information (e.g., credentials) entered at the IdP
         %   will  be leaked to the RP through  the user's browser.
        %The IdP mix-up attack confuses the RP about which IdP is used and the victim RP sends the token to a malicious IdP,
        % which breaks the confidentiality of identity tokens.
%According to these formal proofs \cite{FettKS16, FettKS17},
%    OAuth 2.0 and OIDC are secure except these two attacks.
%UPPRESSO could be integrated into OIDC, which simplifies its security analysis.
SAML-based SSO is also analyzed \cite{ArmandoCCCT08},
    and the RP identity is found not to be correctly bound in the identity tokens of a variant designed by Google.



\vspace{1mm}
\noindent\textbf{Implementation vulnerabilities of SSO protocols.}
Vulnerabilities were found in SSO implementations for web applications,
    resulting in attacks of impersonation and identity injection
     by breaking confidentiality \cite{WangCW12,ccsSunB12,ArmandoCCCPS13,DiscoveringJCS,dimvaLiM16}, integrity \cite{WangCW12,SomorovskyMSKJ12,WangZLG16,MainkaMS16, MainkaMSW17,dimvaLiM16} or RP designation \cite{WangZLG16,MainkaMS16,MainkaMSW17,YangLCZ18,dimvaLiM16} of identity tokens.
%In the SSO services of Google and Facebook, %from the view of browser-relayed traffics
%    logic flaws of the IdPs and RPs were detected \cite{WangCW12}.  % to break the confidentiality and integrity of identity tokens.
Integrity of identity tokens was not ensured in SSO systems  \cite{SomorovskyMSKJ12,WangCW12,WangZLG16,MainkaMS16, MainkaMSW17}
due to software flaws such as XML signature wrapping \cite{SomorovskyMSKJ12},
 incomplete verification by RPs \cite{WangCW12,WangZLG16,MainkaMSW17}, and IdP spoofing \cite{MainkaMS16,MainkaMSW17}.
RP designation is broken
    due to incorrect binding at the IdP \cite{YangLCZ18,WangZLG16} and insufficient verification by RPs \cite{MainkaMS16,MainkaMSW17,YangLCZ18}.

Automatic tools such as SSOScan \cite{ZhouE14}, OAuthTester \cite{YangLLZH16} and S3KVetter \cite{YangLCZ18},
detect the violations of confidentiality, integrity, or RP designation of SSO identity tokens.
Wang et al. \cite{ExplicatingSDK} detect the vulnerable applications
    built with authentication/authorization SDKs,
     due to the implicit assumptions of these SDKs.
Navas et al. \cite{NavasB19} discussed the possible attack patterns of the specification and implementations of OIDC.

In mobile systems,
the IdP App,
    IdP-provided SDKs %(e.g., an encapsulated WebView)
     or browsers
         are responsible for forwarding identity tokens, %from the IdP App to RP Apps.
but none of them ensures the identity tokens are sent to the designated RP only \cite{ChenPCTKT14,WangZLLYLG15}.
%    because a WebView or the system browser cannot authenticate the RP Apps and the IdP App may be repackaged.
The SSO protocols are modified for mobile Apps, but the modifications are not well understood by developers \cite{ChenPCTKT14,YangLS17}.
Vulnerabilities were disclosed in Android Apps,
    to break confidentiality \cite{ChenPCTKT14,WangZLLYLG15,YangLS17,ShiWL19}, integrity \cite{ChenPCTKT14,YangLS17}, and RP designation \cite{ChenPCTKT14,ShiWL19} of identity tokens.
A flaw was found in Google Apps \cite{ArmandoCCCPS13}, allowing a malicious RP to hijack a user's authentication attempt and inject a payload to steal the cookie (or identity token) for another RP.

If a user is compromised,
    the attackers will control his accounts at all RPs.
Single sign-off \cite{GhasemisharifRC18} helps the victim
 to revoke all his tokens accepted and logout from the RPs.


%ÒÔÏÂÄÚÈÝ±»²ð·Öµ½ÉÏÃæÈýµãÄÚÈÝÁË£¬µ«ÊÇ×¢ÊÍÄÚÈÝÓÐ¶ÔÂÛÎÄµÄÏêÏ¸±íÊö

%MohsenS16·ÖÎöÁËÔÚÒÆ¶¯¶ËÊ¹ÓÃwebviewÊµÏÖSSO»áµ¼ÖÂ¶ñÒâRP¿ÉÒÔÏòWebViewÖÐ²åÈëJS´úÂë»ñÈ¡ÓÃ»§µÄtoken £¨confidentiality£©£¬Í¬Ê±Ìá¹©ÁË¶ÔWebViewµÄ±£»¤·ÀÖ¹¶ñÒâRP»ñµÃtoken
%WangZLLYLG15 Ê¹ÓÃ×Ô¶¯»¯¹¤¾ß¶ÔAndroidÓ¦ÓÃ½øÐÐ·ÖÎö£¬×Ü½áÁËAndroidÓ¦ÓÃÃæÁÙµÄ°²È«ÎÊÌâ£º1 Vulnerability I (V1): Improper User-agent£¨Ê¹ÓÃWebViewÊµÏÖSSO£©£¬ 2 Vulnerabili ty II (V2): Lack of Authentication£¨Ê¹ÓÃapp¼äÏûÏ¢´«µÝÊµÏÖSSO£©£¬ 3 Vulnerability III (V3): Inadequate transmission protection £¨ÍøÂç´«ÊäÈ±ÉÙ±£»¤£©£¬ 4 Vulnerabili ty IV (V4): Insecure secret Management £¨ÉÏÃæµÄ client-side logic£©£¬ 5 Vulnerability V (V5): Problematical server-side validation £¨RP serverÓëIdP serverÖ®¼äµÄÏûÏ¢´«µÝÃ»ÓÐÊÜµ½±£»¤£¬ÓÃ»§µÄÐÅÏ¢¿ÉÄÜ±»Ð¹Â¶£¬ÓÃ»§ÐÅÏ¢¿ÉÄÜ±»´Û¸Ä£©£¬ 6 Vulnerabili ty VI (V6): Wrong authentication token £¨Ê¹ÓÃ¹«¿ªÐÅÏ¢×÷Îªidentity token£¬ÆÆ»µconfidentiality £©
%YangLS17 Ê¹ÓÃ¹¤¾ß·ÖÎöAndroid Ó¦ÓÃOAuthÊµÏÖµÄÎÊÌâ£º1 Untrusted Identity Token £¨Ê¹ÓÃserver-to-server transmission±£»¤£¬Ê¹ÓÃÇ©Ãû±£»¤ integrity£©£¬ 2 Heavy Client-Side Logic£¨¿Í»§¶ËÂß¼­£©
%ShiWL19 Ê¹ÓÃmodel-basedµÄ×Ô¶¯»¯¹¤¾ß£¬·ÖÎöÁËAndroidÓ¦ÓÃOAuthÊµÏÖµÄÎÊÌâ£¬°üÀ¨£ºAccess Token Replacement£¨Ìæ»»token£¬ÆÆ»µbinding£©£¬ access token Disclosure £¨confidentiality£©£¬ code Disclosure £¨confidentiality£©£¬App Secret Disclosure £¨¿Í»§¶ËÂß¼­£¬Ö»ÆØÂ¶secret²»»áÆÆ»µ°²È«ÐÔ£©£¬Augmented Token Replacement £¨Ìá¹©tokenÓëRPµÄ°ó¶¨£¬µ«ÊÇ¿ÉÒÔ±»ÈÆ¹ý£¬ the attacker can extract the associated user information of victims from the IdP directly with either the stolen (i.e., network attacker) or obtained (i.e., malicious RP attacker) token, e.g., replaying Step 7 in Fig. 1. Consequently, the attacker can inject both the token and its corresponding user information in his own session£©£¬Profile Vulnerability£¨È±ÉÙÓÃ»§Ã÷È·ÊÚÈ¨£¬Ð¹Â¶ÓÃ»§µÄÒþË½Êý¾Ý£©
% In 2016 Mohsen et al. \cite{MohsenS16} proposed the security of SSO systems implemented through WebView, one of the most important Android components, also facing the threaten of untrusted identity token transmission.
% Moreover, in 2016 Wang et al. \cite{WangZLG16} analysed the design and implementation of SSO systems for multiple platforms with the automatic testing. In 2015 Wnag et al. \cite{WangZLLYLG15}, in 2017 Yang et al. \cite{YangLS17} and in 2019 Shi et al. \cite{ShiWL19} issued the new vulnerabilities in mobile SSO systems and conducted security assessments for the top Android applications and and achieve the statistical result of these applications.

%YeBWD15ÔÚfacebookµÄwebviewÊµÏÖÖÐ£¬Í¨¹ýµÚÈý·½Ó¦ÓÃ»ñµÃfacebookµÄcookie£¬Ê¹¹¥»÷ÕßÄÜ¹»ÒÔÊÜº¦ÕßµÄÉí·ÝµÇÂ¼facebookÓ¦ÓÃ¡£we build a dummy app using the Facebook Login and we authorize the app with public profile permission. Then we used adb tool kit with root privilege to access to storage of the mobile phone. We successfully locate the cookies c_user and xs as well as the credential access_token. The cookies are stored in an sqlite database in mobile phone¡¯s storage at path /data/data/<Apps package name> /databases/webviewCookiesChromium.db and the access_token is stored in an xml file at path /data/data/<App¡¯s package name> /com.facebook.AuthorizationClient. WebViewAuthHandler.TOKEN\_STORE\_KEY.xml.

